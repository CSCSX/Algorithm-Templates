# 后缀数组

- 最终目的：求 `sa[i]`，即每个后缀按字典序排序得到的数组
- $sa_w(i)$ 表示，在所有长度为 $w$，排名为 $i$ 的子串，开始的位置
- $rk_w(i)$ 表示，从 $i$ 位置开始，长度为 $w$ 的子串，在所有长度为 $w$ 的子串中的排名
- 求解过程
  - 令 $rk_1(i) = s[i]$，对于 $sa_1$，对 $1 \cdots n$ 按 $rk_1(i)$ 为关键字排序
  - 已知 $rk_w(i)$，可以快速求出 $sa_{2w}(i)$，对于 $sa_w(i)$，按 $rk_w(sa_w(i))$ 为第一关键字，$rk_w(sa_w(i) + w)$ 为第二关键字排序
  - 直至 $w \ge n$
  - 注意：此过程中，相同的子串需要有相同的排名
- 优化
  - 排序过程用基数排序，因为值域大小为 $O(n)$

  - 第一次计数排序，直接利用上轮排序的结果
    - 对于 $sa_w(i) + w>n$ 的 $sa_w(i)$，下一轮肯定在数组最前面，它们的关键字都是 $0$
    - 对于 $sa_w(i) > w$，的 $sa_w(i)$，它们的 $rk(sa_w(i))$ 在本轮中扮演 $sa_w(i) - w$ 的关键字，而它们的 $rk_w(sa_w(i))$ 在上一轮中已然有序，故直接循序接入数组即可
  - $m$ 是递增到 $n$ 的，而每轮中算出的 $p$ 正是这个 $m$，用 $p$ 作 $m$，且当 $m==n$ 时结束

- `height` 数组

  - 定义 $height[i] = lcp(sa[i], sa[i-1])$
  - 记 $h[i] = height[rk[i]]$，则有 $h[i] \ge h[i-1] +1$

  